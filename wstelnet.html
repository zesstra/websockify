<html>

    <head>
        <title>Telnet client using WebSockets</title>
        <script src="include/base64.js"></script>
        <script src="include/util.js"></script>
        <script src="include/websock.js"></script>
        <script src="include/webutil.js"></script> 
        <script src="include/keysym2.js"></script> 
        <script src="include/TANSI.js"></script> 
        <script src="include/wstelnet.js"></script> 
        <!-- Uncomment to activate firebug lite -->
        <!--
        <script type='text/javascript' 
            src='http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'></script>
        -->


    </head>

    <body style="background-color: #1D1D1D; color: #C0C0C0; height: 97%; width: 97%; font-family: monospace; min-width: 700px;">
        <noscript style="color: #ff0000;">Please enable Javascript.</noscript>
        <div style="height: 100%; width: 100%; margin: 0 auto; color: #C0C0C0; background-color: #1D1D1D;">
            Host: <input id='host' style='width:100'>&nbsp;
            Port: <input id='port' style='width:50'>&nbsp;
            Encrypt: <input id='encrypt' type='checkbox'>&nbsp;
            <input id='connectButton' type='button' value='Connect' style='width:100px' onclick="connect();">&nbsp;

            <br><br>

            <pre id="terminal" style="height: auto; width: 100%; margin: 0 auto; font-size: 1em;"></pre>
            <hr style="border: 0; border-bottom: 1px dashed #C0C0C0;"/>
            <div id="cmd" style="background: 0; border: 0; color: #C0C0C0; outline: 0; font-family: monospace; font-size: 1em;">
                <span id="prompt">&gt;</span> <input type="text" name="i" id="cmdline" style="font-size: 1em; background: 0; border: 0; color: #C0C0C0; outline: 0; font-family: monospace;"/>
            </div>
        </div>

        <script>
            var telnet;

            function connect() {
                telnet.connect($D('host').value,
                               $D('port').value,
                               $D('encrypt').checked);
                $D('connectButton').disabled = true;
                $D('connectButton').value = "Connecting";
            }

            function disconnect() {
                $D('connectButton').disabled = true;
                $D('connectButton').value = "Disconnecting";
                telnet.disconnect();
            }

            function connected() {
                $D('connectButton').disabled = false;
                $D('connectButton').value = "Disconnect";
                $D('connectButton').onclick = disconnect;
            }

            function disconnected() {
                $D('connectButton').disabled = false;
                $D('connectButton').value = "Connect";
                $D('connectButton').onclick = connect;
                document.getElementById("cmd").innerHTML = "<span style='font-style: italic; color: #00FF00;'>Disconnected.</span><br>";
            }

            window.onload = function() {
                console.log("onload");
                var url = document.location.href;
                $D('host').value = (url.match(/host=([^&#]*)/) || ['',''])[1];
                $D('port').value = (url.match(/port=([^&#]*)/) || ['',''])[1];
                
                telnet = Telnet('terminal', connected, disconnected, 'cmdline', 'prompt');
            }

            window.onresize = function(event) {
                try {
                    window.clearTimeout(timeout);
                } finally {
                    timeout = window.setTimeout(telnet.setPageSize, 300);
                }
            }
        </script>

    </body>

</html>
